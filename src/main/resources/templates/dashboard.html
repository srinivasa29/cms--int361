<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - SmartContact</title>

    <!-- Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<!-- üåê Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-gradient fixed-top shadow">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold text-light"><i class="bi bi-person-lines-fill"></i> SmartContact</a>
        <div class="ms-auto d-flex align-items-center">
            <a href="/home" class="btn btn-light btn-sm me-2 active">Dashboard</a>
            <a href="/contacts" class="btn btn-light btn-sm me-2">Contacts</a>
            <a href="/logout" class="btn btn-outline-light btn-sm me-2">Logout</a>
            <i id="themeToggle" class="theme-toggle bi bi-moon"></i>
        </div>
    </div>
</nav>

<!-- üíª Dashboard Section -->
<div class="container mt-5 pt-5 fade-in">

    <h2 class="fw-bold text-gradient mb-4 mt-3 text-center">
        üëã Welcome back, <span th:text="${#authentication.name}" class="text-primary"></span>!
    </h2>

    <!-- Summary Cards -->
    <div class="row g-4 mb-5 justify-content-center">
        <div class="col-md-3 col-sm-6">
            <div class="stat-card glass-card p-3 text-center shadow-lg">
                <i class="bi bi-person-lines-fill fs-1 text-primary"></i>
                <h4 class="fw-bold mt-2" th:text="${contacts.size()}">0</h4>
                <p>Total Contacts</p>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card glass-card p-3 text-center shadow-lg">
                <i class="bi bi-people-fill fs-1 text-success"></i>
                <h4 class="fw-bold mt-2" th:text="${#lists.size(contacts.?[category == 'Family'])}">0</h4>
                <p>Family</p>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card glass-card p-3 text-center shadow-lg">
                <i class="bi bi-briefcase-fill fs-1 text-info"></i>
                <h4 class="fw-bold mt-2" th:text="${#lists.size(contacts.?[category == 'Work'])}">0</h4>
                <p>Work</p>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="stat-card glass-card p-3 text-center shadow-lg">
                <i class="bi bi-emoji-sunglasses-fill fs-1 text-warning"></i>
                <h4 class="fw-bold mt-2" th:text="${#lists.size(contacts.?[category == 'Friends'])}">0</h4>
                <p>Friends</p>
            </div>
        </div>
    </div>

    <!-- Charts + Birthdays -->
    <div class="row g-4 mb-5">
        <!-- üéÇ Upcoming Birthdays -->
        <div class="col-lg-4">
            <div class="card p-3 glass-card shadow h-100">
                <h5 class="text-gradient fw-bold mb-3">üéâ Upcoming Birthdays (Next 7 Days)</h5>
                <div class="birthday-list">
                    <div th:each="c : ${upcomingBirthdays}" class="birthday-item p-2 mb-2 rounded shadow-sm">
                        <strong th:text="${c.name}">Name</strong> üéÇ
                        <span class="float-end text-muted small"
                              th:text="${#temporals.format(c.dob, 'dd MMM')}"></span>
                    </div>
                    <p th:if="${upcomingBirthdays.isEmpty()}" class="text-muted small text-center">
                        No upcoming birthdays üéà
                    </p>
                </div>
            </div>
        </div>

        <!-- üìä Charts -->
        <div class="col-lg-8">
            <div class="card p-4 glass-card shadow">
                <h5 class="text-gradient fw-bold mb-3">üìä Category Overview</h5>
                <div class="row">
                    <div class="col-md-6 mb-4"><canvas id="pieChart"></canvas></div>
                    <div class="col-md-6 mb-4"><canvas id="barChart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Growth Chart + Top Categories -->
    <div class="row g-4 mb-5">
        <div class="col-lg-8">
            <div class="card p-4 glass-card shadow">
                <h5 class="text-gradient fw-bold mb-3">üìà Contacts Growth Trend</h5>
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card p-4 glass-card shadow">
                <h5 class="text-gradient fw-bold mb-3">üèÜ Top Categories</h5>
                <ul class="list-group">
                    <li class="list-group-item border-0"
                        th:each="entry : ${categoryCount}">
                        <strong th:text="${entry.key}">Category</strong>
                        <span class="badge bg-primary float-end" th:text="${entry.value}">0</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- üïì Recently Added -->
    <div class="card p-4 glass-card shadow">
        <h5 class="text-gradient fw-bold mb-3">üïì Recently Added Contacts</h5>
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>Photo</th>
                <th>Name</th>
                <th>Email</th>
                <th>Category</th>
                <th>Phone</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="c, iterStat : ${contacts}" th:if="${iterStat.index < 5}">
                <td>
                    <img th:src="${c.photo} != null ? @{/uploads/{file}(file=${c.photo})} : @{/images/default-avatar.png}"
                         class="rounded-circle border" style="width:45px; height:45px; object-fit:cover;">
                </td>
                <td th:text="${c.name}">Name</td>
                <td th:text="${c.email}">email</td>
                <td>
                    <span th:text="${c.category}"
                          th:class="'badge px-3 py-2 ' +
                          (${c.category.equalsIgnoreCase('Family')} ? 'bg-success' :
                          (${c.category.equalsIgnoreCase('Work')} ? 'bg-primary' :
                          (${c.category.equalsIgnoreCase('Friends')} ? 'bg-warning text-dark' : 'bg-secondary')))"
                          style="font-size: 0.8rem;"></span>
                </td>
                <td th:text="${c.phone}">0000000000</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ‚ö° Chart Logic -->
<script th:inline="javascript">
    const categoryData = [[${categoryCount}]];
    const labels = Object.keys(categoryData);
    const values = Object.values(categoryData);

    // PIE CHART
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: ['#007bff', '#6f42c1', '#ffc107', '#28a745', '#e91e63'],
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });

    // BAR CHART
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Contacts Count',
                data: values,
                backgroundColor: ['#6f42c1', '#007bff', '#ffc107', '#28a745', '#e91e63'],
                borderRadius: 6
            }]
        },
        options: { plugins: { legend: { display: false } } }
    });

    // LINE CHART (Static Sample Data)
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
                label: 'Contacts Added',
                data: [5, 8, 12, 20, 18, 25, 30],
                borderColor: '#6f42c1',
                fill: true,
                backgroundColor: 'rgba(111,66,193,0.2)',
                tension: 0.3,
                borderWidth: 2
            }]
        },
        options: {
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

<script th:src="@{/js/theme.js}"></script>
</body>
</html>
