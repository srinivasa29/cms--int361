<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - SmartContact</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
<!-- ðŸŒ Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold">SmartContact</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navMenu" class="collapse navbar-collapse justify-content-end">
            <div class="d-flex align-items-center">
                <a href="/home" class="btn btn-light btn-sm me-2 fw-semibold">Dashboard</a>
                <a href="/contacts" class="btn btn-light btn-sm me-2 fw-semibold">Contacts</a>
                <a href="/logout" class="btn btn-outline-light btn-sm me-2 fw-semibold">Logout</a>
                <i id="themeToggle" class="theme-toggle bi bi-moon ms-1" title="Toggle Theme"></i>
            </div>
        </div>
    </div>
</nav>

<!-- ðŸ§Š Dashboard Content -->
<div class="container mt-5 fade-in">
    <h2 class="fw-bold mb-4">Welcome back ðŸ‘‹</h2>

    <div class="row g-4">
        <!-- ðŸŽ‰ Birthday Section -->
        <div class="col-md-6">
            <div class="card p-4 shadow glass-card border-0">
                <h5 class="text-primary mb-3 fw-semibold">ðŸŽ‚ Upcoming Birthdays (Next 7 Days)</h5>
                <ul class="list-group list-group-flush">
                    <li th:each="c : ${contacts}"
                        th:text="${c.name + ' - ' + #temporals.format(c.dob, 'dd MMM yyyy')}"
                        class="list-group-item rounded fade-in"></li>
                </ul>
            </div>
        </div>

        <!-- ðŸ“Š Category Chart -->
        <div class="col-md-6">
            <div class="card p-4 shadow glass-card border-0">
                <h5 class="text-primary mb-3 fw-semibold">ðŸ“ˆ Contact Categories</h5>
                <canvas id="chart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- âš¡ Chart Logic -->
<script th:inline="javascript">
    const contacts = [[${contacts}]];
    const categories = {};
    contacts.forEach(c => {
        const cat = c.category || 'Uncategorized';
        categories[cat] = (categories[cat] || 0) + 1;
    });

    new Chart(document.getElementById('chart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                data: Object.values(categories),
                backgroundColor: ['#007bff', '#673ab7', '#ff9800', '#4caf50', '#e91e63', '#00bcd4'],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#333',
                        font: { size: 14, family: 'Poppins, sans-serif' }
                    }
                }
            }
        }
    });
</script>

<script th:src="@{/js/theme.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
